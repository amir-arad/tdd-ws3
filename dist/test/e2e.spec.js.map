{"version":3,"sources":["e2e.spec.js"],"names":[],"mappings":"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","file":"e2e.spec.js","sourcesContent":["require('source-map-support').install();\nvar Promise = require('bluebird');\nvar assert = require('chai').assert;\nimport redis from 'then-redis';\n// import theRealThing from '../src/main';\n\nvar childProcess = require('child_process');\nconst SNIPER_ID = 'sniper';\nconst REDIS_HOSTNAME = 'localhost';\nconst STATUS = 'STATUS';\n\nvar webdriverio = require('webdriverio');\nvar options = { desiredCapabilities: { browserName: 'phantomjs' } };\n\nvar statuses = {\n\tSTATUS_JOINING: 'joining',\n\tSTATUS_LOST: 'lost'\n};\nvar client;\nclass AuctionSniperDriver{\n\tconstructor(){\n\t\tclient = webdriverio.remote(options).init();\n\t}\n\tshowsSniperStatus(statusText) {\n\t\treturn client.url('http://localhost:8888')\n\t\t.then( () => client.getText('#status'))\n\t\t.then(text => {\n\t\t\tassert.equal(text, statusText, 'wrong status');\n\t\t\tconsole.log('Assert Passed!!');\n\t\t});\n\t}\n\tstop(){\n\t\tclient.end();\n\t}\n}\n\nclass ApplicationRunner {\n\tstartBiddingIn(auction) {\n\t\tthis.driver = new AuctionSniperDriver(1000);\n\t\t// start main program with some arguments\n\t\tthis.runningServer = childProcess.exec('node ./dist/src/main.js ' + auction, (error,stdout) => {\n\t\t\tconsole.log(stdout);\n\t\t\tconsole.log(error);\n\t\t});\n\t\treturn this.driver.showsSniperStatus(statuses.STATUS_JOINING); \n\t}\n\tshowsSniperHasLostAuction () {\n\t\treturn this.driver.showsSniperStatus(statuses.STATUS_LOST); \n\t}\n\tstop(){\n\t\t this.runningServer.kill('SIGINT');\n         this.driver.stop();\n\t}\n\t\n}\n\nclass FakeAuctionServer {\n\tconstructor(itemId) {\n\t\tthis.count = 0;\n\t\tthis.itemId = itemId;\n\t\tthis.publisher = redis.createClient();\n\t\tthis.listener = redis.createClient();\n\t\tthis.listener.on('message', (channel, msg) => {\n\t\t\t\tthis.count += 1;\n\t\t\t\tthis.message = msg;\n\t\t})\n\t}\n\thasReceivedJoinRequestFromSniper(){\n        assert(this.count > 0, 'did not receive a message');\n\t\treturn new Promise((res) =>{\n\t\t\tres();\n\t\t});\n\t}\n\tannounceClosed(){\n\t\treturn this.publisher.publish(this.itemId, \"closed\");\n\t}\n\tstartSellingItem() {\n\t\treturn this.listener.subscribe(this.itemId);\n\t}\n\tstop(){\n\t\tthis.listener.quit();\n\t\tthis.publisher.quit();\n\t}\n}\n\ndescribe('the auction sniper', () =>{\n\tvar auction;\n\tvar application;\n\tbeforeEach('auction sniper e2e',() => {\n\t\tauction = new FakeAuctionServer('item-5347');\t\t\n\t\tapplication = new ApplicationRunner();\n\t});\n\n\tit('makes higher bid but loses', () => {\n\t\treturn auction.startSellingItem()\n\t\t\t.then(() => application.startBiddingIn('item-5347'))\n\t\t\t.then(() => auction.hasReceivedJoinRequestFromSniper())\n\n\t\t\t.then(() => auction.reportPrice(1000, 98, 'other bidder'))\n\t\t\t.then(() => application.hasShownSniperIsBidding())\n\t\t\t.then(() => auction.hasReceivedBid(1098, SNIPER_ID))\n\n\t\t\t.then(() => auction.announceClosed())\n\t\t\t.then(() => application.showsSniperHasLostAuction());\n\t});\n\n\tit('joins an auction untill it closes', () => {\n\t\treturn auction.startSellingItem()\n\t\t\t.then(() => application.startBiddingIn('item-5347'))\n\t\t\t.then(() => auction.hasReceivedJoinRequestFromSniper())\n\t\t\t.then(() => auction.announceClosed())\n\t\t\t.then(() => application.showsSniperHasLostAuction());\n\t});\t\n\t\n\tafterEach('something', () => {\n\t\tapplication.stop();\n\t\tauction.stop();\n\t});\n});"],"sourceRoot":"/source/"}