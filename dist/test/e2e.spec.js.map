{"version":3,"sources":["e2e.spec.js"],"names":[],"mappings":"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","file":"e2e.spec.js","sourcesContent":["require('source-map-support').install();\nvar Promise = require('bluebird');\nvar assert = require('chai').assert;\nimport redis from 'then-redis';\n// import theRealThing from '../src/main';\n\nvar childProcess = require('child_process');\nconst SNIPER_ID = 'sniper';\nconst REDIS_HOSTNAME = 'localhost';\nconst STATUS = 'STATUS';\n\nvar webdriverio = require('webdriverio');\nvar options = { desiredCapabilities: { browserName: 'chrome' } };\n\nvar statuses = {\n\tSTATUS_JOINING: 'joining',\n\tSTATUS_LOST: 'lost'\n}\nvar client;\nclass AuctionSniperDriver{\n\t// todo connect with browser to localhost http server, assert that html response shows expected status\n\tconstructor(){\n\t\tclient = webdriverio.remote(options).init();\n\t}\n\tshowsSniperStatus(statusText) {\n\t\treturn client.url('localhost:8888')\n\t\t.then( () => client.getText('#status'))\n\t\t.then(text => {\n\t\t\tassert.equal(text, statusText, 'wrong status');\n\t\t\tconsole.log('Assert Passed!!');\n\t\t});\n\t}\n\tstop(){\n\t\tclient.end();\n\t}\n}\n\nclass ApplicationRunner {\n\tconstructor() {\n\n\t}\n\tstartBiddingIn(auction) {\n\t\tthis.driver = new AuctionSniperDriver(1000);\n\t\t// start main program with some arguments\n\t\tthis.runningServer = childProcess.exec('node ./dist/src/main.js ' + auction, (error,stdout) => {\n\t\t\tconsole.log(stdout);\n\t\t\tconsole.log(error);\n\t\t});\n\t\treturn this.driver.showsSniperStatus(statuses.STATUS_JOINING); \n\t}\n\tshowsSniperHasLostAuction () {\n\t\treturn this.driver.showsSniperStatus(statuses.STATUS_LOST); \n\t}\n\tstop(){\n\t\t this.runningServer.kill('SIGINT');\n         this.driver.stop();\n\t}\n\t\n}\n\nclass FakeAuctionServer {\n\tconstructor(itemId) {\n\t\tthis.count = 0;\n\t\tthis.itemId = itemId;\n\t\tthis.redisListener = redis.createClient();\n\t\tthis.redisListener.on('message', (channel, msg) => {\n\t\t\t\tthis.count += 1;\n\t\t\t\tthis.message = msg;\n\t\t})\n\t}\n\thasRecievedJoinRequestFromSniper(){\n        assert(this.count > 0, 'did not receive a message');\n\t\treturn new Promise((res, rej) =>{\n\t\t\tres();\n\t\t});\n\t}\n\tannounceClosed(){\n\t\treturn redis.createClient().publish(this.itemId, \"lost\");\n\t}\n\tstartSellingItem() {\n\t\treturn this.redisListener.subscribe(this.itemId);\n\t}\n}\n\ndescribe('the auction sniper', () =>{\n\tvar auction;\n\tvar application;\n\tbeforeEach('auction sniper e2e',() => {\n\t\tauction = new FakeAuctionServer('item-5347');\t\t\n\t\tapplication = new ApplicationRunner();\n\t});\n\n\tit('joins an auction untill it closes', () => {\n\t\treturn auction.startSellingItem()\n\t\t\t.then(() => application.startBiddingIn('item-5347'))\n\t\t\t.then(() => auction.hasRecievedJoinRequestFromSniper())\n\t\t\t.then(() => auction.announceClosed())\n\t\t\t.then(() => application.showsSniperHasLostAuction());\n\t});\t\n\t\n\tafterEach('something', () => {\n\t\tapplication.stop();\n\t});\n});"],"sourceRoot":"/source/"}